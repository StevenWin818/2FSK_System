# 更新日志

本文档记录2FSK调制解调系统的所有版本更新。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.3.2] - 2025-11-13

### 安全
- 🛡️ **历史记录清理工具**：新增 `tools/privacy/*` 及使用说明，便于一键移除旧提交中的本地路径。
- 🧾 **运行输出脱敏**：图形与数据导出日志改为显示相对路径，避免控制台泄露本机目录。

### 许可
- 📝 **许可证更新**：项目改用 Mozilla Public License 2.0，并同步更新徽章与文档引用。

### 改进
- 🧭 **单脚本双模式**：文档统一强调 `main.jl` 自动在图形/无图形模式间切换，删除过期的 `main_gui.jl` 引用。
- 🧰 **安装脚本提示**：`install_pyplot.jl` 现在指向 `include("main.jl")` 作为后续步骤。
- 🔄 **默认消息更新**：将示例传输文本调整为 "测试251113"，与主程序保持一致。

### 文档
- README、QUICKSTART、QUICKSTART_GUI、PRIVACY_NOTE 全面更新至 v1.3.2，并修复失效链接。

---

## [1.3.1] - 2025-11-13

### 安全
- 🔒 **隐私信息保护**：移除所有硬编码路径和用户标识
  - 所有具体路径替换为 `<PROJECT_ROOT>` 占位符
  - 移除用户OneDrive名称和用户名
  - 清理所有文档和代码中的隐私信息

### 新增
- 📄 **SETUP.md**：新增路径配置说明文档
  - 详细的路径替换指南
  - 首次运行检查清单
  - Windows路径格式说明

### 改进
- 📖 **README.md**：添加路径配置章节
  - 明确标注需要修改路径
  - 提供实际使用示例
  - 添加占位符说明

### 文档
- 更新所有文档使用通用路径
- 添加路径配置相关说明
- 改进项目可分享性和隐私保护

---

## [1.3.0] - 2025-11-13

### 修复
- 🐛 **图窗无响应问题**：彻底解决GUI冻结问题
  - 问题：`ion()` + `draw()` + `pause()` 导致事件循环管理不当
  - 解决：改用 `ioff()` + 阻塞式 `show()`
  - 结果：图窗完全响应，支持所有交互操作

### 改进
- 🎨 **稳定的GUI体验**：
  - 移除不稳定的 `draw()` 和 `pause()` 调用
  - 使用 `show()` 自动管理事件循环
  - 图窗支持缩放、平移、保存等所有操作
  - 关闭所有图窗后程序自动退出

### 技术
- 后端：TkAgg（优先）/ Qt5Agg（回退）
- 测试：MWORKS Syslab 2025b + Julia 1.9.3
- 状态：生产就绪 ✅

---

## [1.2.1] - 2025-11-13

### 修复
- 🐛 **文件保存路径问题**：所有输出文件现在保存到脚本所在目录
  - 之前：文件保存到MWORKS工作目录（父文件夹）
  - 现在：使用 `@__DIR__` 获取脚本目录，文件保存到项目文件夹
  - 影响文件：waveforms.png, ber_curve.png, spectrum.png, ber_data.csv, spectrum_data.csv

- 🔧 **语法兼容性修复**：
  - 移除 `const` 声明（MWORKS环境不支持局部const）
  - 添加模块重复加载检查（避免WARNING）
  - PyPlot函数显式导入为全局变量

### 改进
- 📁 输出文件路径现在显示完整绝对路径
- ✅ 更好的MWORKS环境兼容性

---

## [1.2.0] - 2025-11-13

### 新增
- 🎨 **图形界面版本** (`main_gui.jl`)
  - 使用PyPlot替代Plots.jl（更稳定）
  - 自动生成高质量PNG图片
  - 完整的中文字体支持
  
- 📊 **可视化输出**：
  - `waveforms.png` - 调制/接收信号波形（3子图）
  - `ber_curve.png` - 误码率曲线（对数坐标）
  - `spectrum.png` - 频谱分析图（标注载波频率）
  
- 🔧 **安装工具**：
  - `install_pyplot.jl` - PyPlot自动安装脚本
  - 智能检测已有安装
  - 自动测试图形功能
  
- 📖 **文档更新**：
  - `QUICKSTART_GUI.md` - 图形版本快速指南
  - 详细的故障排除指南
  - 性能对比表格

### 改进
- ✅ 解决Plots.jl预编译问题（使用PyPlot替代）
- 🎯 图形输出更稳定可靠
- 📈 生成论文级质量图表
- 🔄 保留命令行版本作为快速选项

### 技术细节
- 使用PyPlot的Matplotlib后端
- 中文字体自动配置（SimHei）
- DPI=150高清输出
- 优化的图表布局

### 使用说明

**首次运行**：
```julia
cd("项目路径")
include("install_pyplot.jl")  # 安装PyPlot
include("main_gui.jl")        # 运行图形版本
```

**后续运行**：
```julia
cd("项目路径")
include("main_gui.jl")
```

**如果PyPlot安装困难**：
```julia
include("main.jl")  # 使用命令行版本
```

### 依赖更新
- 新增：PyPlot.jl（图形版本需要）
- 保持：DSP, FFTW, SpecialFunctions等核心包

---

## [1.1.0] - 2025-11-13

### 🎉 重大改进
这是一个里程碑版本，系统从**完全失败到完美运行**的重大突破！

### 修复
- 🐛 **解调算法完全重写**：修复导致70%误码率的严重错误
  - 原实现使用复杂的BPF级联和希尔伯特变换，存在多个问题
  - 包络检测窗口过大（168采样点跨越4个码元）导致信息混叠
  - BPF带宽设置不当（31.5kHz）引起通道串扰
  
- ✅ **新解调实现**：采用能量检测法（非相干解调）
  - 混频 + 能量积分 + 比较判决
  - 无需复杂滤波器设计
  - 判决逻辑简单可靠

### 改进
- ⚡ **性能飞跃**：
  - 误码率：从70% → 接近0% (SNR=10dB)
  - 文本恢复：从失败（乱码）→ 100%成功
  - 比特判决：从严重偏差 → 完全准确
  - BER曲线：从不随SNR变化 → 符合理论趋势

- 🔧 **代码质量**：
  - 简化约50行代码
  - 移除复杂的滤波器级联
  - 提高可维护性和可读性

### 技术细节

#### 新解调算法
```julia
# 对每个码元：
1. 与本地载波f0混频 → 计算能量 energy0
2. 与本地载波f1混频 → 计算能量 energy1  
3. 比较判决：energy1 > energy0 ? 1 : 0
```

#### 性能对比

| 指标 | v1.0.0 | v1.1.0 | 提升 |
|------|--------|--------|------|
| 误码率@10dB | 70% | ~0% | ✅ 完美 |
| 文本恢复率 | 0% | 100% | ✅ 完美 |
| 比特分布准确性 | 错误 | 正确 | ✅ 完美 |
| 代码行数 | 较多 | -50行 | ✅ 简化 |

### 测试验证

**测试消息**: "测试251113"
- ✅ SNR=10dB: 误码数=0, 误码率=0%
- ✅ 恢复文本: "测试251113" (完美匹配)
- ✅ 比特分布: 原始(0=90, 1=38) → 解调(0=90, 1=38)

#### 历史日志对比

以下片段记录了修复前后的实际控制台输出（最初测试使用消息 "测试624438"）：

**v1.0.0（修复前）**
```text
恢复的信息: ￿￿￿￿￿￿￿￿
误码数: 90
误码率: 0.703125
比特分布: 0=1, 1=127
```

**v1.1.0（修复后）**
```text
恢复的信息: 测试624438
误码数: 0
误码率: 0.0
比特分布: 0=90, 1=38
```

### 文件变更

- ✏️ `src/demodulation.jl` 全面重写能量检测判决流程。
- 🛠️ `main.jl` 更新调试输出与性能报告。
- 📚 `CHANGELOG.md`、`README.md`、`QUICKSTART.md` 同步撰写新算法细节。
- 🧹 移除 `run.bat`、`RELEASE_v1.0.1.md` 等不再需要的脚本与旧发布说明。

### 运行方式说明
本系统在**MWORKS Syslab环境**中运行：
1. 打开MWORKS Syslab 2025b
2. 在命令窗口中运行：`include("main.jl")`
3. 查看输出结果和生成的CSV文件

首次在独立Julia环境中运行时，可选执行：
```julia
using Pkg
Pkg.activate(".")
Pkg.instantiate()
```
随后再次包含 `main.jl` 以完成仿真。

---

## [1.0.0] - 2025-11-13

### 新增
- 🎉 **首次发布**
- ✨ 实现完整的2FSK调制解调系统
- 📦 四个核心模块：
  - `modulation.jl` - 调制模块（文本编码、2FSK调制）
  - `channel.jl` - 信道模块（AWGN噪声）
  - `demodulation.jl` - 解调模块（BPF、包络检测）
  - `ber_analysis.jl` - 误码率分析模块
- 📊 支持中文字符传输（UTF-16编码）
- 📈 误码率分析与理论对比
- 🎯 包络解调实现（非相干解调）
- 📉 频谱分析功能
- 💾 数据导出为CSV格式

### 功能特性
- 两种运行模式：
  - `main.jl` - 标准版本（带Plots图形输出）
  - `main_no_plots.jl` - 轻量版本（无图形，适合MWORKS）
- 系统参数：
  - 码元速率：21 KBaud
  - 载波频率：f0=84kHz, f1=42kHz
  - 采样频率：840 kHz
  - 默认SNR：10 dB
- 完整的误码率分析（SNR: 0-14 dB）
- 自动生成分析报告和数据文件

### 技术实现
- 使用DSP.jl实现带通滤波器（4阶Butterworth）
- 希尔伯特变换实现包络检测
- 支持自定义参数配置
- 模块化设计，易于扩展

### 文档
- 📖 完整的README.md
- 📝 详细的代码注释
- 🚀 快速开始指南
- 🔧 MWORKS环境配置说明

### 已知问题
- Plots包在某些MWORKS环境中可能存在预编译问题
  - 解决方案：使用 `main_no_plots.jl`

### 依赖包
- Julia >= 1.6
- DSP.jl >= 0.7
- FFTW.jl >= 1.5
- Plots.jl >= 1.35 (可选)
- SpecialFunctions.jl >= 2.1
- Statistics (标准库)
- Random (标准库)
- Printf (标准库)

---

## [未来计划]


### v1.4.0 (计划中)
- [ ] 支持多种信道模型（瑞利衰落、莱斯信道）
- [ ] 增加信道编码（卷积码、Turbo码）
- [ ] 添加同步模块
- [ ] 支持连续数据流处理

### v2.0.0 (计划中)
- [ ] 完整的通信系统仿真平台
- [ ] Web界面
- [ ] 实时硬件接口
- [ ] 教学演示模式

---

## 版本号说明

版本格式：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能新增
- **修订号**：向下兼容的问题修正

---

**最后更新**: 2025-11-13
